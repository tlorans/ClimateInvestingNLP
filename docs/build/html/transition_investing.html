
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Transition Portfolio &#8212; Climate Investing with NLP 0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conclusion" href="conclusion.html" />
    <link rel="prev" title="Using Business Description for a Firm-Level Estimate of Greeness" href="business_desc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Climate Investing with NLP 0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Investigating the Transition Dimension in Climate Investing with Natural Language Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="greentaxonomy.html">
   A Green Taxonomy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="business_desc.html">
   Using Business Description for a Firm-Level Estimate of Greeness
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Transition Portfolio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conclusion.html">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/transition_investing.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmark-greeness">
   Benchmark Greeness
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#excess-greeness">
   Excess Greeness
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tracking-error-volatility">
     Tracking Error Volatility
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transition-investing-objectives">
     Transition Investing Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#targeting-a-specific-greeness-improvement">
   Targeting a Specific Greeness Improvement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#te-and-excess-greeness-arbitrage">
   TE and Excess Greeness Arbitrage
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Transition Portfolio</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmark-greeness">
   Benchmark Greeness
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#excess-greeness">
   Excess Greeness
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tracking-error-volatility">
     Tracking Error Volatility
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transition-investing-objectives">
     Transition Investing Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#targeting-a-specific-greeness-improvement">
   Targeting a Specific Greeness Improvement
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#te-and-excess-greeness-arbitrage">
   TE and Excess Greeness Arbitrage
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="transition-portfolio">
<h1>Transition Portfolio<a class="headerlink" href="#transition-portfolio" title="Permalink to this headline">#</a></h1>
<p>In what follows we present our simple framework for tilting a benchmark according to a dual objective:</p>
<ol class="arabic simple">
<li><p>Minimizing the tracking error volatility risk and</p></li>
<li><p>Improving the <em>greeness</em> of the tilted version compared to the benchmark.</p></li>
</ol>
<p>To do so, we follow the approach from Roncalli (2023) <span id="id1">[<a class="reference internal" href="references.html#id12" title="Thierry Roncalli. Handbook of Sustainable Finance. SSRN, 2023.">Ron23</a>]</span>, formulating our tilting problem as a portfolio optimization with the presence of a benchmark.</p>
<section id="benchmark-greeness">
<h2>Benchmark Greeness<a class="headerlink" href="#benchmark-greeness" title="Permalink to this headline">#</a></h2>
<p>We need first to define the <em>benchmark greeness</em>.
Let’s assume <span class="math notranslate nohighlight">\(b\)</span> the vector of weights of the benchmark which is equally-weighted.</p>
<p>Let’s assume <span class="math notranslate nohighlight">\(G\)</span> a vector of <em>greeness</em> measure of the stocks composing the benchmark.</p>
<p>The benchmark greeness can be computed as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-cd24719c-774d-49ae-93cc-035b635f0a42">
<span class="eqno">(1)<a class="headerlink" href="#equation-cd24719c-774d-49ae-93cc-035b635f0a42" title="Permalink to this equation">#</a></span>\[\begin{equation}
G(b) = b^TG
\end{equation}\]</div>
<p>Below is the Python code to load the data in the <code class="docutils literal notranslate"><span class="pre">materials</span></code> folder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">greeness</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;results_greeness.csv&#39;</span><span class="p">)</span>
<span class="n">data_fin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_fin.csv&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">greeness</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_fin</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;Ticker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">list_entities</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Ticker</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">greeness_score</span> <span class="o">=</span> <span class="n">greeness</span><span class="p">[</span><span class="n">greeness</span><span class="p">[</span><span class="s1">&#39;Ticker&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list_entities</span><span class="p">)]</span><span class="o">.</span><span class="n">Greeness</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
<p>Below is the Python code for computing the benchmark greeness:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_entities</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_entities</span><span class="p">))</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">greeness_score</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="excess-greeness">
<h2>Excess Greeness<a class="headerlink" href="#excess-greeness" title="Permalink to this headline">#</a></h2>
<p>Having the previous benchmark, let’s assume a portfolio with the same issuers than the benchmark, but with different weights <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">greeness_score</span><span class="p">)),</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>We define the <em>excess greeness</em> of our portfolio, that is the positive or negative deviation from our benchmark greeness:</p>
<div class="amsmath math notranslate nohighlight" id="equation-761df55a-14a1-4ce2-a73c-86408352a8ac">
<span class="eqno">(2)<a class="headerlink" href="#equation-761df55a-14a1-4ce2-a73c-86408352a8ac" title="Permalink to this equation">#</a></span>\[\begin{equation}
G(x|b) = (x - b)^T G
\end{equation}\]</div>
<p>Below is the code to compute the excess greeness of our portfolio:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">excess_greeness</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">G</span>
</pre></div>
</div>
<section id="tracking-error-volatility">
<h3>Tracking Error Volatility<a class="headerlink" href="#tracking-error-volatility" title="Permalink to this headline">#</a></h3>
<p>We can compare the relative performance of the portfolio compared to the benchmark with the tracking error volatility:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ccc07a05-8a4d-4309-bfe2-71e4558a01a3">
<span class="eqno">(3)<a class="headerlink" href="#equation-ccc07a05-8a4d-4309-bfe2-71e4558a01a3" title="Permalink to this equation">#</a></span>\[\begin{equation}
\sigma(x|b) = \sqrt{(x - b)^T \Sigma (x - b)}
\end{equation}\]</div>
<p>Below we compute the tracking error volatility:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;Ticker&#39;</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;Return&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">te</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Sigma</span> <span class="o">@</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="transition-investing-objectives">
<h3>Transition Investing Objectives<a class="headerlink" href="#transition-investing-objectives" title="Permalink to this headline">#</a></h3>
<p>In the previous example, we compared the greeness performance of a portfolio against a benchmark, with predefined portfolio’s weights.</p>
<p>However, the objective of investors is to improve the portfolio’s greeness while controlling the tracking error volatility.</p>
<p>Denoting <span class="math notranslate nohighlight">\(\gamma\)</span> as the risk tolerance parameter, we have the following optimization problem:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{aligned}
&amp; x^* = 
&amp; &amp; argmin \frac{1}{2} \sigma^2 (x |b) - \gamma G (x | b) \\
&amp; \text{subject to}
&amp; &amp; 1_5^Tx = 1, \\
&amp;&amp;&amp; 0_5 \leq x \leq 1_5.
\end{aligned}
\end{equation*}\]</div>
<p>Where the constraints simply mean that the sum of the resulting weights <span class="math notranslate nohighlight">\(x\)</span> need to be 1 and that individual weights <span class="math notranslate nohighlight">\(x_i\)</span> need to between 0 and 1.</p>
<p>Varying the parameter value of <span class="math notranslate nohighlight">\(\gamma\)</span> gives you the efficient frontier of tracking a benchmark with a greeness objective.</p>
<p>Below we install and import the <code class="docutils literal notranslate"><span class="pre">qpsolvers</span></code> package and formulate the QP problem of the optimization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qpsolvers</span> <span class="kn">import</span> <span class="n">solve_qp</span>

<span class="k">def</span> <span class="nf">portfolio_tilting</span><span class="p">(</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;QP formulation&quot;&quot;&quot;</span>
  
  <span class="n">P</span> <span class="o">=</span> <span class="n">Sigma</span> <span class="c1"># Q </span>
  <span class="n">q</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="n">Sigma</span> <span class="o">@</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># R, minus because we want to maximize it!</span>
  <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="c1"># A</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">])</span> <span class="c1"># B</span>
  <span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
  <span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">solve_qp</span><span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span>
               <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span>
               <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="p">,</span> 
               <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
               <span class="n">lb</span> <span class="o">=</span> <span class="n">lb</span><span class="p">,</span>
               <span class="n">ub</span> <span class="o">=</span> <span class="n">ub</span><span class="p">,</span>
               <span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;osqp&#39;</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">x</span>


<span class="k">def</span> <span class="nf">get_perf_tilting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Sigma</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
  <span class="n">excess_greeness</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">G</span>
  <span class="n">te</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Sigma</span> <span class="o">@</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">excess_greeness</span><span class="p">,</span> <span class="n">te</span>
</pre></div>
</div>
</section>
</section>
<section id="targeting-a-specific-greeness-improvement">
<h2>Targeting a Specific Greeness Improvement<a class="headerlink" href="#targeting-a-specific-greeness-improvement" title="Permalink to this headline">#</a></h2>
<p>We will now target a specific portfolio greeness improvement and see the resulting portfolio’s weights.</p>
<p>To do so, one can use bisection algorithm:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span> 
    <span class="c1"># approximates a root, R, of f bounded </span>
    <span class="c1"># by a and b to within tolerance </span>
    <span class="c1"># | f(m) | &lt; tol with m the midpoint </span>
    <span class="c1"># between a and b Recursive implementation</span>
    
    <span class="c1"># check if a and b bound a root</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
         <span class="s2">&quot;The scalars a and b do not bound a root&quot;</span><span class="p">)</span>
        
    <span class="c1"># get midpoint</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="c1"># stopping condition, report m as root</span>
        <span class="k">return</span> <span class="n">m</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">m</span><span class="p">)):</span>
        <span class="c1"># case where m is an improvement on a. </span>
        <span class="c1"># Make recursive call with a = m</span>
        <span class="k">return</span> <span class="n">bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">m</span><span class="p">)):</span>
        <span class="c1"># case where m is an improvement on b. </span>
        <span class="c1"># Make recursive call with b = m</span>
        <span class="k">return</span> <span class="n">bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">greeness_targeting</span><span class="p">(</span><span class="n">Sigma</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">target_excess_score</span><span class="p">):</span>
  <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">portfolio_tilting</span><span class="p">(</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">,</span>
                        <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
                        <span class="n">gamma</span> <span class="o">=</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">G</span> <span class="o">-</span> <span class="n">target_excess_score</span>
    
  <span class="n">x_star_greeness</span> <span class="o">=</span> <span class="n">portfolio_tilting</span><span class="p">(</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">,</span>
                        <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
                        <span class="n">gamma</span> <span class="o">=</span> <span class="n">bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">x_star_greeness</span>
</pre></div>
</div>
<p>Let’s test with a target improvement of 10%:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_star_greeness</span> <span class="o">=</span> <span class="n">greeness_targeting</span><span class="p">(</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">,</span>
                                     <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
                                     <span class="n">target_excess_score</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<p>And let’s plot the resulting top 15 securities in terms of weights deviation from the benchmark:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results_target</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Ticker&quot;</span><span class="p">:</span><span class="n">list_entities</span><span class="p">,</span>
                               <span class="s2">&quot;Security&quot;</span><span class="p">:</span><span class="n">df</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                               <span class="s2">&quot;Tilted_Weights&quot;</span><span class="p">:</span><span class="n">x_star_greeness</span><span class="p">,</span> <span class="s2">&quot;Initial_Weights&quot;</span><span class="p">:</span><span class="n">b</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
<span class="n">results_target</span><span class="p">[</span><span class="s1">&#39;Deviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_target</span><span class="p">[</span><span class="s1">&#39;Tilted_Weights&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_target</span><span class="p">[</span><span class="s1">&#39;Initial_Weights&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>                    <span class="c1"># This is one library for plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>          <span class="c1"># Yet another library for visualization</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>   

<span class="n">results_target</span> <span class="o">=</span> <span class="n">results_target</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;Deviation&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">top_15</span> <span class="o">=</span> <span class="n">results_target</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">&#39;Deviation&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="n">f</span> <span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">top_15</span><span class="p">,</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Security&#39;</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Deviation&#39;</span><span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">top_15</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="weights">
<img alt="_images/weights_dev.png" src="_images/weights_dev.png" />
<figcaption>
<p><span class="caption-text">Figure: Top 15 securities in terms of weights deviation from the benchmark</span><a class="headerlink" href="#weights" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>With a targeted excess greeness score of 10%, we can see that the properties of our transition portfolio follows the expected behavior of our mixed green-brown taxonomy:</p>
<ul class="simple">
<li><p>The securities with the highest exposure to greeness (ie. the pure-players) are the ones with the highest positive weights deviation</p></li>
<li><p>The neutral securities follow the greenest ones, replacing the brown securities in the portfolio.</p></li>
</ul>
<p>However, we need to investigate the cost associated with this greeness improvement, noteworthy knowing the narrow universe of green investments.</p>
</section>
<section id="te-and-excess-greeness-arbitrage">
<h2>TE and Excess Greeness Arbitrage<a class="headerlink" href="#te-and-excess-greeness-arbitrage" title="Permalink to this headline">#</a></h2>
<p>We can measure the cost of deviation from the initial benchmark with the tracking error. We can test the properties of our transition metrics by testing the cost associated with various levels of improvement.</p>
<p>Below is the Python code to compute the tracking error for various levels of greeness excess:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">list_targets</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span> <span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>

<span class="n">list_te</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">list_targets</span><span class="p">:</span>
  <span class="n">x_star_greeness</span> <span class="o">=</span> <span class="n">greeness_targeting</span><span class="p">(</span><span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">,</span>
                                     <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span>
                                     <span class="n">target_excess_score</span> <span class="o">=</span> <span class="n">target</span><span class="p">)</span>
  <span class="n">excess_greeness</span><span class="p">,</span> <span class="n">te</span> <span class="o">=</span> <span class="n">get_perf_tilting</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_star_greeness</span><span class="p">,</span> 
                                       <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> 
                                       <span class="n">Sigma</span> <span class="o">=</span> <span class="n">Sigma</span><span class="p">,</span>
                                       <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="p">)</span>
  
  <span class="n">list_te</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">te</span><span class="p">)</span>

<span class="n">f</span> <span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_targets</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_te</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Excess Greeness Target (in %)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TE Volatility (in %)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Below is a chart showing the increase of tracking error as we increase the excess greeness target.</p>
<figure class="align-default" id="arbitrage">
<img alt="_images/arbitrage.png" src="_images/arbitrage.png" />
<figcaption>
<p><span class="caption-text">Figure: TE Volatility vs. Excess Greeness Targets</span><a class="headerlink" href="#arbitrage" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A low level of targeted improvement leads to small tracking error, because from 10 to 30% of excess greeness target, the investment universe is still large, with both green and neutral activities. However, exceeding 30% of exces greeness target leads to important tracking error, as the investment universe shrinks to the narrow green activities pure-players universe.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="business_desc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Using Business Description for a Firm-Level Estimate of Greeness</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="conclusion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Conclusion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Thomas Lorans<br/>
  
      &copy; Copyright 2023, Thomas Lorans.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>